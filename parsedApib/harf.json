{
    "title": "حرف",
    "attributes": [
        {
            "key": "FORMAT",
            "value": "1A"
        },
        {
            "key": "HOST",
            "value": "http://harf.roshan-ai.ir"
        }
    ],
    "copies": [
        "حرف، یک ای‌پی‌آیِ تبدیل گفتار به نوشتار فارسی است که می‌تواند صدای ورودی را اعم از صوت یا ویدیو یا پخش زنده به متن تبدیل کند. حرف با شنیدن هزاران ساعت گفتارِ فارسی در انواع و اقسام لحن‌ها، رده‌های سنی و جنسیت‌های مختلف، به‌خوبی تعلیم دیده است و با دقت بالایی این کار را انجام می‌دهد.\n\nبرای دسترسی به این ای‌پی‌آی، به یک <code>TOKEN_KEY</code> نیاز دارید که می‌توانید از طریق ایمیلِ harf@roshan-ai.ir درخواست دهید."
    ],
    "resources": [
        {
            "title": "تبدیل صدا به متن به‌شکل همگام",
            "href": "/api/transcribe_files/",
            "hrefVariables": [],
            "copies": [
                "این تابع، فایل‌های صوتی یا ویدیویی را دریافت می‌کند و متن هر فایل را به‌شکل JSON تحویل می‌دهد. در خروجی، آدرس هر فایل (<code>media_url</code>) به‌همراه مدت‌زمان فایل (<code>duration</code>) و سگمنت‌ها (<code>segments</code>) بازگردانده می‌شود. هر سگمنت، بازهٔ زمانی کوتاهی شامل سه پارامتر <code>start</code> و <code>end</code> و <code>text</code> است که به‌ترتیب بیانگر شروع بازه، پایان بازه و متن بازه است."
            ],
            "transitions": [
                {
                    "title": "مثال: ارسال لینک فایل",
                    "copies": [],
                    "httpRequest": {
                        "method": "POST",
                        "headerAttributes": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Token TOKEN_KEY"
                            }
                        ],
                        "sections": [
                            {
                                "type": "dataStructure",
                                "members": [
                                    {
                                        "description": "لینک فایل‌های ورودی (صدا یا ویدیو)",
                                        "typeAttributes": [
                                            "required"
                                        ],
                                        "key": "media_urls",
                                        "value": "List of URLs",
                                        "valueType": "string",
                                        "enumaration": []
                                    }
                                ]
                            },
                            {
                                "type": "messageBody",
                                "contentType": "application/json",
                                "content": "{\n  \"media_urls\": [\"https://i.ganjoor.net/a2/41417.mp3\"]\n}\n"
                            },
                            {
                                "type": "messageBodySchema",
                                "contentType": "application/schema+json",
                                "content": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"media_urls\": {\n      \"type\": \"string\"\n    }\n  },\n  \"required\": [\n    \"media_urls\"\n  ]\n}"
                            }
                        ]
                    },
                    "httpResponse": {
                        "headerAttributes": [],
                        "sections": [
                            {
                                "type": "messageBody",
                                "content": "[\n  {\n    \"media_url\": \"https://i.ganjoor.net/a2/41417.mp3\",\n    \"duration\": \"0:00:44\",\n    \"segments\": [\n      {\n        \"start\": \"0:00:00\",\n        \"end\": \"0:00:02\",\n        \"text\": \"حکایت\"\n      },\n      {\n        \"start\": \"0:00:02\",\n        \"end\": \"0:00:06\",\n        \"text\": \"یکی را از حکما شنیدم که می گفت\"\n      },\n      {\n        \"start\": \"0:00:06\",\n        \"end\": \"0:00:11\",\n        \"text\": \"هرگز کسی به جهل خویش اقرار نکرده است\"\n      },\n      {\n        \"start\": \"0:00:11\",\n        \"end\": \"0:00:16\",\n        \"text\": \"مگر آن کس که چون دیگری در سخن باشد\"\n      },\n      {\n        \"start\": \"0:00:16\",\n        \"end\": \"0:00:21\",\n        \"text\": \"همچنان ناتمام گفته سخن آغاز کند\"\n      },\n      ...\n    ]\n  }\n]\n"
                            }
                        ]
                    }
                },
                {
                    "title": "مثال: ارسال مستقیم فایل",
                    "copies": [],
                    "httpRequest": {
                        "method": "POST",
                        "headerAttributes": [
                            {
                                "key": "Content-Type",
                                "value": "multipart/form-data; boundary={boundary value}"
                            },
                            {
                                "key": "Authorization",
                                "value": "Token TOKEN_KEY"
                            }
                        ],
                        "sections": [
                            {
                                "type": "dataStructure",
                                "members": [
                                    {
                                        "description": "فایل ورودی",
                                        "typeAttributes": [
                                            "required"
                                        ],
                                        "key": "media",
                                        "value": "file in binary",
                                        "valueType": "string",
                                        "enumaration": []
                                    }
                                ]
                            },
                            {
                                "type": "messageBody",
                                "contentType": "multipart/form-data",
                                "content": "--{boundary value}\nContent-Disposition: form-data; name='document'; filename='FILE NAME'\nContent-Type: text/plain (according to the type of the uploaded file)\n\n{file content}\n--{boundary value}\n"
                            }
                        ]
                    },
                    "httpResponse": {
                        "headerAttributes": [],
                        "sections": [
                            {
                                "type": "messageBody",
                                "content": "[\n  {\n    \"media_url\": \"http://harf.roshan-ai.ir/media/files/96/84/859267728361.mp3\",\n    \"duration\": \"0:00:44\",\n    \"segments\": [\n      {\n        \"start\": \"0:00:00\",\n        \"end\": \"0:00:02\",\n        \"text\": \"حکایت\"\n      },\n      {\n        \"start\": \"0:00:02\",\n        \"end\": \"0:00:06\",\n        \"text\": \"یکی را از حکما شنیدم که می گفت\"\n      },\n      {\n        \"start\": \"0:00:06\",\n        \"end\": \"0:00:11\",\n        \"text\": \"هرگز کسی به جهل خویش اقرار نکرده است\"\n      },\n      {\n        \"start\": \"0:00:11\",\n        \"end\": \"0:00:16\",\n        \"text\": \"مگر آن کس که چون دیگری در سخن باشد\"\n      },\n      {\n        \"start\": \"0:00:16\",\n        \"end\": \"0:00:21\",\n        \"text\": \"همچنان ناتمام گفته سخن آغاز کند\"\n      },\n      ...\n    ]\n  }\n]\n"
                            }
                        ]
                    }
                }
            ]
        },
        {
            "title": "تبدیل صدا به متن به‌شکل ناهمگام",
            "href": "/api/transcribe_files/",
            "hrefVariables": [],
            "copies": [
                "در این بخش نحوه تحلیل فایل به صورت ناهمگام، توضیح داده شده است."
            ],
            "transitions": [
                {
                    "title": "مثال: ارسال لینک فایل به‌شکل ناهمگام",
                    "copies": [
                        "اگر در درخواست خود مقدار پارامتر <code>wait</code> را برابر <code>false</code> قرار دهید، درخواست به‌شکل ناهمگام ارسال می‌شود. در این حالت دیگر لازم نیست منتظر نتیجه بمانید. درعوض، در خروجی، دو پارامتر <code>state</code> و <code>task_ids</code> دریافت می‌کنید که اولی وضعیت پردازش را مشخص می‌کند و دومی لیستی از <code>task_id</code> ها را برمی‌گرداند.  هر <code>task_id</code> شناسهٔ پردازش یک فایل است که بعداً می‌توانید با تابع «دریافت پاسخ به‌شکل ناهمگام» از وضعیت پردازش آن باخبر شوید. در درخواست به‌شکل ناهمگام اگر نتیجهٔ پردازش آماده باشد، بلافاصله در خروجی نمایش داده می‌شود، اگر نه، وضعیت پردازش در پارامتر <code>state</code> برگردانده می‌شود، مثلاً <code>PENDING</code> یعنی در حال پردازش است."
                    ],
                    "httpRequest": {
                        "method": "POST",
                        "headerAttributes": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Token TOKEN_KEY"
                            }
                        ],
                        "sections": [
                            {
                                "type": "dataStructure",
                                "members": [
                                    {
                                        "description": "لینک فایل‌های ورودی",
                                        "typeAttributes": [
                                            "required"
                                        ],
                                        "key": "media_urls",
                                        "value": "List of URLs",
                                        "valueType": "string",
                                        "enumaration": []
                                    },
                                    {
                                        "description": "اگر <code>false</code> باشد یعنی منتظر نتیجه نمی‌ماند. درعوض شناسهٔ پردازش فایل‌ها (<code>task_ids</code>) را برمی‌گرداند تا خودتان هرازگاهی وضعیت پردازش را چک کنید و بعد از پایان پردازش، مجددا درخواست دهید و خروجی نهایی را ببینید.",
                                        "typeAttributes": [],
                                        "key": "wait",
                                        "value": true,
                                        "valueType": "boolean",
                                        "enumaration": []
                                    }
                                ]
                            },
                            {
                                "type": "messageBody",
                                "contentType": "application/json",
                                "content": "{\n  \"media_urls\": [\"https://i.ganjoor.net/a2/41417.mp3\"],\n  \"wait\": false\n}\n"
                            },
                            {
                                "type": "messageBodySchema",
                                "contentType": "application/schema+json",
                                "content": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"media_urls\": {\n      \"type\": \"string\"\n    },\n    \"wait\": {\n      \"type\": \"boolean\"\n    }\n  },\n  \"required\": [\n    \"media_urls\"\n  ]\n}"
                            }
                        ]
                    },
                    "httpResponse": {
                        "headerAttributes": [],
                        "sections": [
                            {
                                "type": "messageBody",
                                "content": "{\n  \"state\":\"PENDING\",\n  \"task_ids\":[\"...\"]\n}\n"
                            }
                        ]
                    }
                },
                {
                    "title": "مثال: دریافت پاسخ به‌شکل ناهمگام",
                    "copies": [
                        "با ارسال یک یا چند شناسهٔ پردازش در پارامتر <code>task_ids</code>، نتیجهٔ پردازش آن‌ها بازگردانده می‌شود. در پاسخ خروجی، پارامتر <code>state</code> می‌تواند سه حالت داشته باشد. <code>PENDING</code> یعنی در حال پردازش، <code>FAILURE</code> یعنی بروز خطا، <code>TIMEOUT</code> یعنی پردازش فایل بیش از تحمل سامانه بوده است."
                    ],
                    "httpRequest": {
                        "method": "POST",
                        "headerAttributes": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Token TOKEN_KEY"
                            }
                        ],
                        "sections": [
                            {
                                "type": "dataStructure",
                                "members": [
                                    {
                                        "description": "لیست شناسه‌های پردازش",
                                        "typeAttributes": [
                                            "required"
                                        ],
                                        "key": "task_ids",
                                        "value": "List of task ids",
                                        "valueType": "string",
                                        "enumaration": []
                                    },
                                    {
                                        "description": "همانند قبل.",
                                        "typeAttributes": [],
                                        "key": "wait",
                                        "value": true,
                                        "valueType": "boolean",
                                        "enumaration": []
                                    }
                                ]
                            },
                            {
                                "type": "messageBody",
                                "contentType": "application/json",
                                "content": "{\n  \"tasks_ids\": [\"...\"],\n  \"wait\": false\n}\n"
                            },
                            {
                                "type": "messageBodySchema",
                                "contentType": "application/schema+json",
                                "content": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"task_ids\": {\n      \"type\": \"string\"\n    },\n    \"wait\": {\n      \"type\": \"boolean\"\n    }\n  },\n  \"required\": [\n    \"task_ids\"\n  ]\n}"
                            }
                        ]
                    },
                    "httpResponse": {
                        "headerAttributes": [],
                        "sections": [
                            {
                                "type": "messageBody",
                                "content": "{\"state\":\"PENDING\"}\n"
                            }
                        ]
                    }
                }
            ]
        },
        {
            "title": "تبدیل پخش زندهٔ صدا به متن",
            "href": "/ws_api/transcribe_files/wav/sync/",
            "hrefVariables": [],
            "copies": [
                "برای تبدیل صدای درحال‌پخش (زنده، لایو، استریم) باید از طریق وب‌سوکت به سامانه متصل شوید. در این حالت، پس از برقراری ارتباط، فایل باید در قالب wav به صورت باینری به سرور ارسال شود.\n\n{\"segment_id\": 1, \"text\": \"سازمان بهداشت جهانی\", \"start\": \"0:00:00\", \"end\": \"0:00:05\"}\n\nاگر پردازش کامل نشده باشد، پاسخی به‌شکل زیر ارسال می‌شود:\n\n{\"state\": \"PENDING\"}\n\nدر انتها، برای اعلام پایان فرایند پردازش باید متن \"finalize\"به سرور ارسال شود."
            ],
            "transitions": [
                {
                    "title": "مثال",
                    "copies": [],
                    "httpRequest": {
                        "method": "POST",
                        "headerAttributes": [
                            {
                                "key": "Content-Type",
                                "value": "ws_api/transcribe_files/wav/sync/"
                            }
                        ],
                        "sections": []
                    },
                    "httpResponse": {
                        "headerAttributes": [],
                        "sections": [
                            {
                                "type": "messageBody",
                                "content": "{\"state\":\"PENDING\"}\n"
                            }
                        ]
                    }
                }
            ]
        }
    ]
}